language: java
dist: trusty

cache:
  directories:
    - '$HOME/.m2'
    - '$HOME/.sonar/cache'

jdk:
  - oraclejdk8
#  - oraclejdk9
#  - oraclejdk10
#  - openjdk7
#  - openjdk8
#  - openjdk9
#  - openjdk10
#  - openjdk11

#stages:
#  - package
#  - test
#  - coverage
#
#jobs:
#  include:
#    - stage: package
#      env:
#        - MAVEN_OPTS=-Xmx1024m -DskipTests=true -Dlogback.configurationFile=logback-travis.xml
#      script:
#        - "mvn clean install"
#    - stage: test
#      env:
#        - MAVEN_OPTS=-Xmx1024m -Dlogback.configurationFile=logback-travis.xml
#      script:
#        - "mvn test"
#    - stage: coverage
#      env:
#        - MAVEN_OPTS=-Xmx1024m -Dlogback.configurationFile=logback-travis.xml -Dcoverage.port=random -Dcoverage.securePort=random
#      script:
#        - mvn -q coveralls:report -P coverage
#    - stage: static analyis
#          env:
#            - MAVEN_OPTS=-Dsonar.organization=jooby-project -Dsonar.host.url=https://sonarcloud.io -Dsonar.login=
#          script:
#            - "mvn sonar:sonar"

#branches:
#  only:
#    - master

before_install:
  - export MAVEN_OPTS="-Xmx1024m"
  - export MAVEN_OPTS="-Dlogback.configurationFile=../../build/logback-travis.xml ${MAVEN_OPTS}"
  - export MAVEN_OPTS="-Dcoverage.port=random ${MAVEN_OPTS}"
  - export MAVEN_OPTS="-Dcoverage.securePort=random ${MAVEN_OPTS}"
  # -DskipTests=true -Dmaven.javadoc.skip=true
  # -Dsonar.host.url=https://sonarcloud.io -Dsonar.branch.name=master -Dsonar.projectVersion=${SONAR_VERSION}

addons:
  sonarcloud:
    organization: $SONAR_ORGANIZATION
    token: $SONAR_TOKEN

script:
  #- mvn -q -pl jooby -am -Dsonar.branch.name=${TRAVIS_BRANCH} clean install org.jacoco:jacoco-maven-plugin:prepare-agent package sonar:sonar coveralls:report -P coverage
 # mvn -Dsonar.login=fcff19dd0c924736522c14558e35bb96c326141b -Dsonar.organization=feffi-github -DskipTests=true -Dmaven.javadoc.skip=true -pl jooby -am -Dsonar.host.url=https://sonarcloud.io clean install org.jacoco:jacoco-maven-plugin:prepare-agent package sonar:sonar
  - "mvn -DskipTests=true -Dmaven.javadoc.skip=true -pl jooby -am -Dsonar.host.url=https://sonarcloud.io clean install org.jacoco:jacoco-maven-plugin:prepare-agent sonar:sonar"

after_success:
  - bash <(curl -s https://codecov.io/bash)